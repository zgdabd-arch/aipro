{
  "entities": {
    "StudentProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StudentProfile",
      "type": "object",
      "description": "Stores information about a student's profile.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the StudentProfile entity."
        },
        "name": {
          "type": "string",
          "description": "The student's full name."
        },
        "age": {
          "type": "number",
          "description": "The student's age."
        },
        "gradeLevel": {
          "type": "string",
          "description": "The student's grade level."
        },
        "country": {
          "type": "string",
          "description": "The student's country of residence."
        },
        "preferredLearningLanguage": {
          "type": "string",
          "description": "The student's preferred learning language."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 StudentProfile)"
        }
      },
      "required": [
        "id",
        "name",
        "age",
        "gradeLevel",
        "country",
        "preferredLearningLanguage",
        "userId"
      ]
    },
    "StudyPlan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StudyPlan",
      "type": "object",
      "description": "Stores the generated study plan for a student.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the StudyPlan entity."
        },
        "subject": {
          "type": "string",
          "description": "The subject the study plan is for."
        },
        "content": {
          "type": "string",
          "description": "The actual study plan content generated by the AI."
        },
        "studentProfileId": {
          "type": "string",
          "description": "Reference to StudentProfile. (Relationship: StudentProfile 1:N StudyPlan)"
        }
      },
      "required": [
        "id",
        "subject",
        "content",
        "studentProfileId"
      ]
    },
    "Progress": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Progress",
      "type": "object",
      "description": "Tracks the student's progress in a study plan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Progress entity."
        },
        "studyPlanId": {
          "type": "string",
          "description": "Reference to StudyPlan. (Relationship: StudyPlan 1:N Progress)"
        },
        "date": {
          "type": "string",
          "description": "The date of the progress update.",
          "format": "date-time"
        },
        "percentageComplete": {
          "type": "number",
          "description": "The percentage of the study plan completed."
        }
      },
      "required": [
        "id",
        "studyPlanId",
        "date",
        "percentageComplete"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Stores basic user account information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "subscriptionStatus": {
          "type": "string",
          "description": "The subscription status of the user."
        }
      },
      "required": [
        "id",
        "email",
        "subscriptionStatus"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user account information. Path-based ownership for private user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/studentProfiles/{studentProfileId}",
        "definition": {
          "entityName": "StudentProfile",
          "schema": {
            "$ref": "#/backend/entities/StudentProfile"
          },
          "description": "Stores student profile data. Path-based ownership, ensuring only the user can access their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "studentProfileId",
              "description": "The unique identifier for the student profile."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/studentProfiles/{studentProfileId}/studyPlans/{studyPlanId}",
        "definition": {
          "entityName": "StudyPlan",
          "schema": {
            "$ref": "#/backend/entities/StudyPlan"
          },
          "description": "Stores study plans associated with a specific student profile. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "studentProfileId",
              "description": "The unique identifier for the student profile."
            },
            {
              "name": "studyPlanId",
              "description": "The unique identifier for the study plan."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/studentProfiles/{studentProfileId}/studyPlans/{studyPlanId}/progress/{progressId}",
        "definition": {
          "entityName": "Progress",
          "schema": {
            "$ref": "#/backend/entities/Progress"
          },
          "description": "Stores progress updates for a specific study plan. Path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "studentProfileId",
              "description": "The unique identifier for the student profile."
            },
            {
              "name": "studyPlanId",
              "description": "The unique identifier for the study plan."
            },
            {
              "name": "progressId",
              "description": "The unique identifier for the progress entry."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure secure access to user data by leveraging path-based ownership and structural segregation. Each student's profile, study plans, and progress are stored under their unique user ID, enabling straightforward security rules based on `request.auth.uid`. This approach eliminates the need for complex authorization logic or cross-collection `get()` calls, promoting Authorization Independence. Student profiles are stored under `/users/{userId}/studentProfiles/{studentProfileId}`, study plans under `/users/{userId}/studentProfiles/{studentProfileId}/studyPlans/{studyPlanId}`, and progress updates under `/users/{userId}/studentProfiles/{studentProfileId}/studyPlans/{studyPlanId}/progress/{progressId}`. This hierarchical structure provides clear ownership and avoids mixing data with differing access requirements in the same collection, thus facilitating secure `list` operations (QAPs) within the user's own data. Subscription status is stored within the User document itself, allowing easy access and management. User data is stored under `/users/{userId}`."
  }
}